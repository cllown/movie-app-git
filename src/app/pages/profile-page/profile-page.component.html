<ng-container *ngIf="isLoggedin; else notLoggedIn">
  <p-card class="profile-page">
    <div class="profile-header">
      <h2>Welcome {{ username$ | async }}!</h2>
      <div class="profile-actions">
        <p-button
          label="Mood Recommendations"
          icon="pi pi-smile"
          severity="help"
          (click)="openMoodPopup()"
        ></p-button>
        <p-button
          label="Logout"
          icon="pi pi-sign-out"
          severity="danger"
          (click)="logout()"
        ></p-button>
      </div>
    </div>


    <p-tabView>

      <p-tabPanel header="Recommendations">
      <h2 class="page-title">Recommended for You</h2>
        <ng-container *ngIf="recommendationMovies$ | async as recommendation">
          <ng-container *ngIf="recommendation && recommendation.length > 0; else noMovies">
            <div class="all-movies__items items-movies recommendation-list">
              @for(movie of recommendation; track movie.id) {
                <app-movie-card
                  [movie]="movie"
                  [isActionsShow]="true"
                  [isRemoveButtonShow]="false"
                ></app-movie-card>
              }
            </div>
          </ng-container>
          <ng-template #noMovies>
            <p>No recommendations yet, put some films to favourite</p>
          </ng-template>
        </ng-container>
      </p-tabPanel>


      <p-tabPanel header="liked">
        <ng-container *ngIf="favouriteMovies$ | async as movies;">
            <ng-container *ngIf="movies && movies.length > 0; else noMovies">
              <div class="items-movies">
                @for(movie of movies; track movie.id){
                <app-movie-card [movie]="movie" [isActionsShow]="false" [isRemoveButtonShow]="true"
                  (removeFromList)="removeFromFavourites(movie.id)"></app-movie-card>
                }
              </div>
            </ng-container>
            <ng-template #noMovies>
              <p>You haven't added any movies to this category yet.</p>
            </ng-template>
          </ng-container>
      </p-tabPanel>


      <p-tabPanel header="watch list">
        <ng-container *ngIf="watchListMovies$ | async as movies;">
          <ng-container *ngIf="movies && movies.length > 0; else noMovies">
            <div class="items-movies">
              @for(movie of movies; track movie.id){
              <app-movie-card [movie]="movie" [isActionsShow]="false" [isRemoveButtonShow]="true"
                (removeFromList)="removeFromWatchList(movie.id)"></app-movie-card>
              }
            </div>
          </ng-container>
          <ng-template #noMovies>
            <p>You haven't added any movies to this category yet.</p>
          </ng-template>
        </ng-container>
      </p-tabPanel>

      <p-tabPanel *ngFor="let list of customLists" [header]="list.name">
        <div class="custom-list-header">
          <p-button
            icon="pi pi-trash"
            label="Delete List"
            (click)="deleteList(list.id)"
            severity="danger"
          ></p-button>
        </div>
        <ng-container *ngIf="(customListMovies[list.id] ?? []).length > 0; else noMovies">
          <div class="items-movies">
            @for(movie of customListMovies[list.id]; track movie.id){
              <app-movie-card
                [movie]="movie"
                [isActionsShow]="false"
                [isRemoveButtonShow]="true"
                (removeFromList)="removeFromCustomList(movie.id, list.id)"
              ></app-movie-card>
            }
          </div>
        </ng-container>
        <ng-template #noMovies>
          <p>No movies in this list yet.</p>
        </ng-template>
      </p-tabPanel>

  <!-- Таб для создания нового списка -->
      <p-tabPanel header="+" headerStyleClass="plus-tab-header">
        <div class="create-list-tab">
          <input
            [(ngModel)]="newListName"
            type="text"
            placeholder="New list name"
            class="p-inputtext"
            styleClass="custom-blue-button"
          />
          <p-button
            label="Create"
            icon="pi pi-check"
            (click)="createNewList()"
            [disabled]="!newListName.trim()"
            styleClass="custom-blue-button"
          ></p-button>
        </div>
      </p-tabPanel>

    </p-tabView>
  </p-card>
</ng-container>

<ng-template #notLoggedIn>
  <p>You are not logged in. Please log in first.</p>
</ng-template>
