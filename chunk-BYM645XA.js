import{Bc as B,Eb as d,Fb as g,G as I,I as C,M as m,P as u,a as v,b as f,ec as S,k as n,l as $,n as a,q as y}from"./chunk-625T36XV.js";var i={apiBaseUrl:"https://api.themoviedb.org/3",apiKey:"8a701f184202b480bd359829ea7c74cb",accountId:"21364383"};var U=(()=>{let o=class o{constructor(t){this.httpClient=t,this.token=null,this.sessionId=null}getOptions(){return{params:new d().set("api_key",i.apiKey)}}setToken(t){this.token=t}setSessionId(t){this.sessionId=t}getSessionId(){return this.sessionId}getRequestToken(){return this.httpClient.get(`${i.apiBaseUrl}/authentication/token/new`,this.getOptions())}askForPermission(t,e,s){let r={username:t,password:e,request_token:s};return this.httpClient.post(`${i.apiBaseUrl}/authentication/token/validate_with_login`,r,this.getOptions())}createSessionId(t){let e={request_token:t};return this.httpClient.post(`${i.apiBaseUrl}/authentication/session/new`,e,this.getOptions())}register(t,e){let s=localStorage.getItem("users"),r=s?JSON.parse(s):[];return r.some(l=>l.username===t)?$(()=>new Error("\u041A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447 \u0443\u0436\u0435 \u0456\u0441\u043D\u0443\u0454")):(r.push({username:t,password:e}),localStorage.setItem("users",JSON.stringify(r)),n(void 0))}loginWithLocal(t,e){return JSON.parse(localStorage.getItem("users")||"{}")[t]===e}};o.\u0275fac=function(e){return new(e||o)(u(g))},o.\u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"});let p=o;return p})();var D=(()=>{let o=class o{constructor(t,e,s){this.httpClient=t,this.authService=e,this.store=s,this.cache=new Map}getCachedData(t,e){let s=this.constructFullUrl(t,e);return this.cache.has(s)?n(this.cache.get(s)):this.httpClient.get(s).pipe(C(r=>this.cache.set(s,r)))}constructFullUrl(t,e){if(!e)return t;let s=new URLSearchParams(e).toString();return`${t}?${s}`}getPopularMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/popular?api_key=${i.apiKey}`)}getTopRatedMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/top_rated?api_key=${i.apiKey}`)}getNowPlayingMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/now_playing?api_key=${i.apiKey}`)}getUpcomingMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/upcoming?api_key=${i.apiKey}`)}getRecommendationForMovie(t){return this.getCachedData(`${i.apiBaseUrl}/movie/${t}/recommendations?api_key=${i.apiKey}`)}getSmartRecommendations(t){let s=t.map(r=>this.getRecommendationForMovie(r));return y(s).pipe(a(r=>{let c=r.flatMap(h=>h.results),l=new Map;for(let h of c)t.includes(h.id)||l.set(h.id,h);return Array.from(l.values())}))}getPersonalRecommendations(){return this.getFavouriteMovies().pipe(a(t=>t.map(e=>e.id)),I(t=>t.length?this.getSmartRecommendations(t):n([])))}getMovieDetails(t){return this.getCachedData(`${i.apiBaseUrl}/movie/${t}?api_key=${i.apiKey}`)}getMoviesByParams(t){return this.httpClient.get(`${i.apiBaseUrl}/discover/movie`,this.getOptions(t))}getMoviesByGenres(t){return this.getMoviesByParams({with_genres:t.join(",")})}getMoviesByRating(t){return this.getMoviesByParams({"vote_average.gte":t.toString()})}getGenres(){return this.httpClient.get(`${i.apiBaseUrl}/genre/movie/list?api_key=${i.apiKey}`)}getOptions(t={}){return{params:new d({fromObject:f(v({},t),{api_key:i.apiKey})})}}updateList(t,e,s){let r=this.authService.getSessionId();if(!r)return n([]);let c={media_type:"movie",media_id:e,[t]:s};return this.httpClient.post(`${i.apiBaseUrl}/account/${i.accountId}/${t}`,c,this.getOptions({session_id:r}))}getFavouriteMovies(){let t=this.authService.getSessionId();if(t){let e={session_id:t};return this.httpClient.get(`${i.apiBaseUrl}/account/${i.accountId}/favorite/movies`,this.getOptions(e)).pipe(a(s=>s.results))}return n([])}getWatchListMovies(){let t=this.authService.getSessionId();if(t){let e={session_id:t};return this.httpClient.get(`${i.apiBaseUrl}/account/${i.accountId}/watchlist/movies`,this.getOptions(e)).pipe(a(s=>s.results))}return n([])}searchMovies(t){return this.httpClient.get(`${i.apiBaseUrl}/search/movie?api_key=${i.apiKey}&query=${t}`).pipe(a(e=>e.results))}getGenreNames(t){return this.store.select(B).pipe(a(e=>t.map(s=>e?.find(r=>r.id===s)).filter(s=>s!==void 0)))}checkIfMovieInList(t,e){return e.pipe(a(s=>s?.some(r=>r.id===t)||!1))}createCustomList(t,e="",s=!0){let r=this.authService.getSessionId();if(!r)return n(null);let c={name:t,description:e,language:"en",public:s};return this.httpClient.post(`${i.apiBaseUrl}/list`,c,this.getOptions({session_id:r}))}deleteCustomList(t){let e=this.authService.getSessionId();return e?this.httpClient.delete(`${i.apiBaseUrl}/list/${t}`,this.getOptions({session_id:e})):n(null)}getCustomLists(){let t=this.authService.getSessionId();return t?this.httpClient.get(`${i.apiBaseUrl}/account/${i.accountId}/lists`,this.getOptions({session_id:t})):n([])}addMovieToCustomList(t,e){let s=this.authService.getSessionId();if(!s)return n(null);let r={media_id:e};return this.httpClient.post(`${i.apiBaseUrl}/list/${t}/add_item`,r,this.getOptions({session_id:s}))}removeMovieFromCustomList(t,e){let s=this.authService.getSessionId();if(!s)return n(null);let r={media_id:e};return this.httpClient.post(`${i.apiBaseUrl}/list/${t}/remove_item`,r,this.getOptions({session_id:s}))}clearCustomList(t){let e=this.authService.getSessionId();return e?this.httpClient.post(`${i.apiBaseUrl}/list/${t}/clear`,{},this.getOptions({session_id:e})):n(null)}getMoviesInCustomList(t){return this.httpClient.get(`${i.apiBaseUrl}/list/${t}`,this.getOptions()).pipe(a(e=>e.items))}getMovieTrailer(t){return this.httpClient.get(`${i.apiBaseUrl}/movie/${t}/videos?api_key=${i.apiKey}`).pipe(a(e=>{let s=e.results.find(r=>r.type==="Trailer"&&r.key);return s?s.key:null}))}};o.\u0275fac=function(e){return new(e||o)(u(g),u(U),u(S))},o.\u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"});let p=o;return p})();export{U as a,D as b};
