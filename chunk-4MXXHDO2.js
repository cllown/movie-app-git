import{Ac as S,Db as m,Eb as g,F as y,H as I,L as l,O as h,a as d,b as v,dc as C,k as n,l as f,n as a,q as $}from"./chunk-AXS64SOQ.js";var i={apiBaseUrl:"https://api.themoviedb.org/3",apiKey:"8a701f184202b480bd359829ea7c74cb",accountId:"21364383"};var B=(()=>{let o=class o{constructor(t){this.httpClient=t,this.token=null,this.sessionId=null}getOptions(){return{params:new m().set("api_key",i.apiKey)}}setToken(t){this.token=t}setSessionId(t){this.sessionId=t}getSessionId(){return this.sessionId}getRequestToken(){return this.httpClient.get(`${i.apiBaseUrl}/authentication/token/new`,this.getOptions())}askForPermission(t,e,s){let r={username:t,password:e,request_token:s};return this.httpClient.post(`${i.apiBaseUrl}/authentication/token/validate_with_login`,r,this.getOptions())}createSessionId(t){let e={request_token:t};return this.httpClient.post(`${i.apiBaseUrl}/authentication/session/new`,e,this.getOptions())}register(t,e){let s=localStorage.getItem("users"),r=s?JSON.parse(s):[];return r.some(u=>u.username===t)?f(()=>new Error("\u041A\u043E\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447 \u0443\u0436\u0435 \u0456\u0441\u043D\u0443\u0454")):(r.push({username:t,password:e}),localStorage.setItem("users",JSON.stringify(r)),n(void 0))}loginWithLocal(t,e){return JSON.parse(localStorage.getItem("users")||"{}")[t]===e}};o.\u0275fac=function(e){return new(e||o)(h(g))},o.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"});let p=o;return p})();var R=(()=>{let o=class o{constructor(t,e,s){this.httpClient=t,this.authService=e,this.store=s,this.cache=new Map}getCachedData(t,e){let s=this.constructFullUrl(t,e);return this.cache.has(s)?n(this.cache.get(s)):this.httpClient.get(s).pipe(I(r=>this.cache.set(s,r)))}constructFullUrl(t,e){if(!e)return t;let s=new URLSearchParams(e).toString();return`${t}?${s}`}getPopularMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/popular?api_key=${i.apiKey}`)}getTopRatedMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/top_rated?api_key=${i.apiKey}`)}getNowPlayingMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/now_playing?api_key=${i.apiKey}`)}getUpcomingMovies(){return this.getCachedData(`${i.apiBaseUrl}/movie/upcoming?api_key=${i.apiKey}`)}getRecommendationForMovie(t){return this.getCachedData(`${i.apiBaseUrl}/movie/${t}/recommendations?api_key=${i.apiKey}`)}getSmartRecommendations(t){let e=t.map(s=>this.getRecommendationForMovie(s));return $(e).pipe(a(s=>{let r=s.flatMap(u=>u.results),c=new Map;for(let u of r)t.includes(u.id)||c.set(u.id,u);return Array.from(c.values())}))}getPersonalRecommendations(){return this.getFavouriteMovies().pipe(a(t=>t.map(e=>e.id)),y(t=>t.length?this.getSmartRecommendations(t):n([])))}getMovieDetails(t){return this.getCachedData(`${i.apiBaseUrl}/movie/${t}?api_key=${i.apiKey}`)}getMoviesByParams(t){return this.httpClient.get(`${i.apiBaseUrl}/discover/movie`,this.getOptions(t))}getMoviesByGenres(t){return this.getMoviesByParams({with_genres:t.join(",")})}getMoviesByRating(t){return this.getMoviesByParams({"vote_average.gte":t.toString()})}getGenres(){return this.httpClient.get(`${i.apiBaseUrl}/genre/movie/list?api_key=${i.apiKey}`)}getOptions(t={}){return{params:new m({fromObject:v(d({},t),{api_key:i.apiKey})})}}getMoodBasedRecommendations(t){let e=Math.floor(Math.random()*10)+1;return this.getMoviesByParams({with_genres:t.join(","),page:e.toString()}).pipe(a(s=>s.results.slice(0,3)))}updateList(t,e,s){let r=this.authService.getSessionId();if(!r)return n([]);let c={media_type:"movie",media_id:e,[t]:s};return this.httpClient.post(`${i.apiBaseUrl}/account/${i.accountId}/${t}`,c,this.getOptions({session_id:r}))}getFavouriteMovies(){let t=this.authService.getSessionId();return t?this.httpClient.get(`${i.apiBaseUrl}/account/${i.accountId}/favorite/movies`,this.getOptions({session_id:t})).pipe(a(e=>e.results)):n([])}getWatchListMovies(){let t=this.authService.getSessionId();return t?this.httpClient.get(`${i.apiBaseUrl}/account/${i.accountId}/watchlist/movies`,this.getOptions({session_id:t})).pipe(a(e=>e.results)):n([])}searchMovies(t){return this.httpClient.get(`${i.apiBaseUrl}/search/movie?api_key=${i.apiKey}&query=${t}`).pipe(a(e=>e.results))}getGenreNames(t){return this.store.select(S).pipe(a(e=>t.map(s=>e?.find(r=>r.id===s)).filter(s=>s!==void 0)))}checkIfMovieInList(t,e){return e.pipe(a(s=>s?.some(r=>r.id===t)||!1))}createCustomList(t,e="",s=!0){let r=this.authService.getSessionId();if(!r)return n(null);let c={name:t,description:e,language:"en",public:s};return this.httpClient.post(`${i.apiBaseUrl}/list`,c,this.getOptions({session_id:r}))}deleteCustomList(t){let e=this.authService.getSessionId();return e?this.httpClient.delete(`${i.apiBaseUrl}/list/${t}`,this.getOptions({session_id:e})):n(null)}getCustomLists(){let t=this.authService.getSessionId();return t?this.httpClient.get(`${i.apiBaseUrl}/account/${i.accountId}/lists`,this.getOptions({session_id:t})):n([])}addMovieToCustomList(t,e){let s=this.authService.getSessionId();return s?this.httpClient.post(`${i.apiBaseUrl}/list/${t}/add_item`,{media_id:e},this.getOptions({session_id:s})):n(null)}removeMovieFromCustomList(t,e){let s=this.authService.getSessionId();return s?this.httpClient.post(`${i.apiBaseUrl}/list/${t}/remove_item`,{media_id:e},this.getOptions({session_id:s})):n(null)}clearCustomList(t){let e=this.authService.getSessionId();return e?this.httpClient.post(`${i.apiBaseUrl}/list/${t}/clear`,{},this.getOptions({session_id:e})):n(null)}getMoviesInCustomList(t){return this.httpClient.get(`${i.apiBaseUrl}/list/${t}`,this.getOptions()).pipe(a(e=>e.items))}getMovieTrailer(t){return this.httpClient.get(`${i.apiBaseUrl}/movie/${t}/videos?api_key=${i.apiKey}`).pipe(a(e=>{let s=e.results.find(r=>r.type==="Trailer");return s?s.key:null}))}};o.\u0275fac=function(e){return new(e||o)(h(g),h(B),h(C))},o.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"});let p=o;return p})();export{B as a,R as b};
